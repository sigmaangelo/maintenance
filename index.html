<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Cloaked Entry</title>
 
<style>
  body { background:white; font-family:Arial; text-align:center; margin-top:100px; }
</style>
</head>

<body>

<h1>Press to Cloak</h1>
<button onclick="cloak()">CLOAK</button>

<script>
const PASSWORD = "1234";

function cloak() {
    let win = window.open("about:blank", "_blank");

    win.document.write(`
      <h2>Enter Password</h2>
      <input id="pass" type="password" />
      <button onclick="login()">Enter</button>
      <p id='msg'></p>

      <script>
      async function login() {
        const entered = document.getElementById('pass').value;

        if (entered !== "${PASSWORD}") {
            document.getElementById('msg').innerText = "Wrong password";
            return;
        }

        const fd = new FormData();
        fd.append("password", "${PASSWORD}");

        const res = await fetch("/login", { method:"POST", body:fd });

        if (!res.ok) {
            document.getElementById('msg').innerText = "Server rejected";
            return;
        }

        // OPEN games.html CLOAKED
        let g = window.open("about:blank", "_blank");
        let iframe = g.document.createElement("iframe");

        iframe.src = "/home.html"; 
        iframe.style = "position:fixed;top:0;left:0;width:100%;height:100%;border:none;";

        g.document.body.style.margin = 0;
        g.document.body.appendChild(iframe);

        // OPTIONAL: Close login window
        window.close();
      }
      <\/script>
    `);

    win.document.close();
}
</script>

</body>
</html>
